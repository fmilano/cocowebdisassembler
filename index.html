<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Color Computer web disassembler</title>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js" type="text/javascript"></script>
  <script src="./src/view/hex0r.js" type="text/javascript"></script>
  <link rel="stylesheet" type="text/css" href="./src/view/hex0r.css" />
  <link rel="stylesheet" type="text/css" href="./lib/bootstrap.min.css" />
</head>

<body>

  <div id="navbar"></div>

  <input type="file" id="files" name="files[]" accept=".bin" single />
  <output id="list"></output>

  <!--<div id="hexViewer" class="hex0rwindow" data-row-width="16" data-word-size="1" data-row-break="8"
    data-trim="true" data-base64="true" data-caption="Section hex dump"
    data-highlights=""
    data-show-line-nums="true" data-offset="5" title=""></div>-->

  <script type="module">
    import { decbParse } from './src/modules/decb_parser.mjs';
    import { setupNavBar } from './src/view/setupNavBar.mjs';
    import { Section, addSection, saveAllSections } from './src/model/section.mjs';


    window.addEventListener("load", setupNavBar);

    function handleFileSelect(evt) {
      var file = evt.target.files[0]; // FileList object

      document.getElementById('list').innerHTML = '<ul><strong>', escape(file.name), '</strong></ul>';

      var reader = new FileReader();

      reader.onload = function () {
        let retVal = decbParse(reader.result)
        //let base64String = btoa(String.fromCharCode(...new Uint8Array(retVal.sections[1].data)));
        //console.log(base64String);
        //document.getElementById('hexViewer').innerHTML = base64String;

        //markup_hex0rwindow($("#hexViewer"));

        const sections = retVal.sections;
        for (let i = 0; i < sections.length; i++) {
          let section = new Section(i, sections[i].length, sections[i].startAddress);
          addSection(section);
        }

        saveAllSections();
      }

      reader.readAsArrayBuffer(file);
    }

    document.getElementById('files').addEventListener('change', handleFileSelect, false);
  </script>

  <!--<menu>
    <li><a href="listSections.html"><button type="button">List all sections</button></a></li>
    <li><a href="createSection.html"><button type="button">Add a new section</button></a></li>
    <li><a href="updateSection.html"><button type="button">Update a section</button></a></li>
    <li><a href="deleteSection.html"><button type="button">Delete a section</button></a></li>
    <li><button type="button" onclick="Section.clearData()">Clear database</button></li>
    <li><button type="button" onclick="Section.createTestData()">Create test data</button></li>
  </menu>-->
</body>

</html>