<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Color Computer web disassembler</title>
  <link rel="stylesheet" type="text/css" href="./lib/bootstrap.min.css" />
</head>

<body>

  <div id="navbar"></div>

  <input type="file" id="files" name="files[]" accept=".bin" single />
  <output id="list"></output>

  <script type="module">
    import { decbParse } from './src/modules/decb_parser.mjs';
    import { setupNavBar } from './src/view/setupNavBar.mjs';
    import { Section, addSection, saveAllSections } from './src/model/section.mjs';


    window.addEventListener("load", setupNavBar);

    function handleFileSelect(evt) {
      var file = evt.target.files[0]; // FileList object

      document.getElementById('list').innerHTML = '<ul><strong>', escape(file.name), '</strong></ul>';

      var reader = new FileReader();

      reader.onload = function () {
        let retVal = decbParse(reader.result);

        const sections = retVal.sections;
        for (let i = 0; i < sections.length; i++) {
          let section = new Section(i, sections[i].length, sections[i].startAddress, sections[i].data, "LDA $4000");
          addSection(section);
        }

        saveAllSections();
      }

      reader.readAsArrayBuffer(file);
    }

    document.getElementById('files').addEventListener('change', handleFileSelect, false);
  </script>

</body>

</html>